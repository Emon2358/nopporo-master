<html>
  <head>
    <!-- AudioWorkletNode を無効化して、ScriptProcessorNode を強制利用 -->
    <script>
      window.AudioWorkletNode = undefined;
    </script>
    <!-- zmusic.js が dist フォルダ内にある場合のパス -->
    <script src="dist/zmusic.js"></script>
    <script>
      // ArrayBuffer を取得するためのXHRラッパー
      function xhr(url) {
        return new Promise(function (resolve, reject) {
          var xhr = new XMLHttpRequest();
          xhr.open('GET', url, true);
          xhr.responseType = 'arraybuffer';
          xhr.addEventListener('load', e => {
            resolve(xhr.response);
            xhr.abort();
          }, false);
          xhr.send();
        });
      }
      
      // 音データを保持する変数
      let soundData = null;
      
      // ZMUSIC のインストールと音データの取得
      Promise.all([
         ZMUSIC.install(),
         xhr('./test.zms')
      ]).then(results => {
         soundData = results[1];
         // 自動再生したい場合は以下のコメントを外す
         // ZMUSIC.play(soundData);
      });
      
      // DOM読み込み後にボタンのクリックイベントを設定
      window.addEventListener('DOMContentLoaded', function() {
        document.getElementById('playButton').addEventListener('click', function() {
          if (soundData) {
            ZMUSIC.play(soundData);
          } else {
            console.log("まだ音データが読み込まれていません。");
          }
        });
      });
    </script>
  </head>
  <body>
    <!-- ボタンを押すと音を再生 -->
    <button id="playButton">音を鳴らす</button>
  </body>
</html>
